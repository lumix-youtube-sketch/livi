<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>livi - AI Productivity</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
/* --- –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò --- */
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#0a0a0a;color:white;max-width:428px;margin:0 auto;overflow-x:hidden;padding-bottom:100px}

/* --- –ê–ù–ò–ú–ê–¶–ò–ò --- */
@keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
@keyframes roll{from{transform:translateX(0)}to{transform:translateX(-80%)}}

.slide-up{animation:slideUp .3s ease-out}
.float{animation:float 3s ease-in-out infinite}

/* --- –®–†–ò–§–¢–´ –ò –¶–í–ï–¢–ê --- */
:root {
    --primary: #8B9A9C;
    --accent: #9CB3B5;
    --gold: #D4AF7A;
    --rare: #a335ee;
    --epic: #ff8000;
    --legendary: #ffb400;
}

/* --- HEADER --- */
.header{padding:20px;display:flex;justify-content:space-between;align-items:center;background:rgba(20,20,20,0.8);backdrop-filter:blur(10px);position:sticky;top:0;z-index:100;border-bottom:1px solid #222}
.header-title{font-size:24px;font-weight:800;background:linear-gradient(90deg, var(--primary), #fff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.stats-row{display:flex;gap:10px}
.stat-item{background:#1a1a1a;padding:6px 12px;border-radius:12px;display:flex;align-items:center;gap:6px;font-weight:bold;border:1px solid #333}

/* --- CONTENT --- */
.content{padding:16px}
.card{background:#161616;border-radius:24px;padding:20px;margin-bottom:16px;border:1px solid #222}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}

/* --- LIVI AVATAR --- */
.livi-container{position:relative;width:150px;height:180px;margin:0 auto;display:flex;flex-direction:column;align-items:center;justify-content:center}
.livi-body{width:100px;height:100px;background:var(--primary);border-radius:50%;position:relative;z-index:2;border:4px solid #333}
.livi-eye{width:10px;height:10px;background:white;border-radius:50%;position:absolute;top:35%}
.eye-left{left:25%}.eye-right{right:25%}
.livi-mouth{width:20px;height:8px;border-bottom:3px solid white;border-radius:50%;position:absolute;bottom:30%;left:50%;transform:translateX(-50%)}
/* –û–¥–µ–∂–¥–∞ */
.item-cap{position:absolute;top:-10px;width:70px;height:30px;background:var(--gold);border-radius:20px 20px 5px 5px;z-index:5}
.item-glasses{position:absolute;top:32%;width:75px;height:15px;background:rgba(0,0,0,0.8);border-radius:4px;z-index:6;border:1px solid #444}
.item-shirt{position:absolute;bottom:-10px;width:110px;height:40px;background:#333;border-radius:10px;z-index:1}

/* --- –ö–ù–û–ü–ö–ò --- */
.btn{width:100%;padding:16px;border-radius:16px;border:none;font-weight:bold;cursor:pointer;transition:0.2s;display:flex;align-items:center;justify-content:center;gap:8px}
.btn-primary{background:var(--primary);color:white}
.btn-stars{background:linear-gradient(90deg, #FFD700, #FFA500);color:black;margin-top:10px}

/* --- NAVIGATION --- */
.nav{position:fixed;bottom:0;width:100%;max-width:428px;background:#111;display:flex;justify-content:space-around;padding:15px 0;border-top:1px solid #222;z-index:1000}
.nav-item{color:#555;text-align:center;font-size:11px;cursor:pointer}
.nav-item.active{color:var(--primary)}

/* --- CASE OPENING MODAL --- */
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:2000;display:none;flex-direction:column;align-items:center;justify-content:center;padding:20px}
.roulette-container{width:100%;height:120px;background:#1a1a1a;border:2px solid var(--gold);overflow:hidden;position:relative;margin:20px 0;border-radius:12px}
.roulette-line{position:absolute;left:50%;height:100%;width:2px;background:var(--gold);z-index:10;transform:translateX(-50%)}
.roulette-track{display:flex;height:100%;align-items:center;width:max-content;padding-left:50%}
.roulette-item{width:100px;height:100px;flex-shrink:0;margin:0 5px;background:#222;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:40px;border-bottom:4px solid #444}

/* --- SHOP --- */
.chest-card{text-align:center;background:linear-gradient(180deg, #1a1a1a, #111);border:2px solid #333}
.chest-price{color:var(--gold);font-size:20px;font-weight:800;margin:10px 0}

/* --- AI ANALYSIS --- */
.ai-badge{display:inline-block;padding:4px 8px;background:rgba(156,179,181,0.2);border:1px solid var(--primary);border-radius:8px;font-size:10px;color:var(--primary);margin-bottom:10px}
.ai-text{font-style:italic;color:#ccc;line-height:1.4}

/* --- CHART --- */
.chart-container{height:150px;display:flex;align-items:flex-end;gap:8px;margin-top:20px}
.chart-bar{flex:1;background:var(--primary);border-radius:4px 4px 0 0;position:relative;min-height:5px}
.chart-label{position:absolute;bottom:-20px;font-size:10px;left:50%;transform:translateX(-50%)}
</style>
</head>
<body>

<div class="loading-screen" id="loadingScreen"><div class="loading-logo">livi</div></div>

<div id="app"></div>

<div class="modal" id="caseModal">
    <h2 id="modalTitle">–û—Ç–∫—Ä—ã—Ç–∏–µ —Å—É–Ω–¥—É–∫–∞...</h2>
    <div class="roulette-container">
        <div class="roulette-line"></div>
        <div class="roulette-track" id="rouletteTrack"></div>
    </div>
    <div id="winDisplay" style="text-align:center; display:none;">
        <div id="winIcon" style="font-size:80px; margin-bottom:10px;"></div>
        <h3 id="winName"></h3>
        <button class="btn btn-primary" style="margin-top:20px" onclick="closeModal()">–ó–∞–±—Ä–∞—Ç—å</button>
    </div>
</div>

<script>
// --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø TG ---
const tg = window.Telegram.WebApp;
tg.expand();

// --- –î–ê–ù–ù–´–ï –ü–†–ï–î–ú–ï–¢–û–í ---
const LOOT_POOL = [
    {id: 'cap_red', name: '–ö—Ä–∞—Å–Ω–∞—è –∫–µ–ø–∫–∞', icon: 'üß¢', type: 'head', rarity: 'common'},
    {id: 'cap_gold', name: '–ó–æ–ª–æ—Ç–∞—è –∫–æ—Ä–æ–Ω–∞', icon: 'üëë', type: 'head', rarity: 'legendary'},
    {id: 'glasses_dark', name: '–ß–µ—Ä–Ω—ã–µ –æ—á–∫–∏', icon: 'üï∂Ô∏è', type: 'glass', rarity: 'rare'},
    {id: 'glasses_neon', name: '–ù–µ–æ–Ω–æ–≤—ã–π –≤–∏–∑–æ—Ä', icon: 'ü•Ω', type: 'glass', rarity: 'epic'},
    {id: 'shirt_tux', name: '–°–º–æ–∫–∏–Ω–≥', icon: 'üëî', type: 'body', rarity: 'epic'},
    {id: 'shirt_fire', name: '–û–≥–Ω–µ–Ω–Ω–æ–µ —Ö—É–¥–∏', icon: 'üî•', type: 'body', rarity: 'rare'},
    {id: 'item_gem', name: '–ê–ª–º–∞–∑', icon: 'üíé', type: 'misc', rarity: 'legendary'}
];

const RARITY_COLORS = {
    common: '#888',
    rare: '#a335ee',
    epic: '#ff8000',
    legendary: '#ffb400'
};

// --- –°–û–°–¢–û–Ø–ù–ò–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ---
let state = {
    points: 500,
    streak: 1,
    activeTab: 'home',
    inventory: [],
    equipped: { head: null, glass: null, body: null },
    stats: [15, 40, 25, 60, 30, 80, 45], // –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –Ω–µ–¥–µ–ª—é
    tasksDone: 0,
    energy: 85
};

// --- –°–û–•–†–ê–ù–ï–ù–ò–ï ---
function save() {
    localStorage.setItem('livi_pro_data', JSON.stringify(state));
}

function load() {
    const data = localStorage.getItem('livi_pro_data');
    if(data) state = JSON.parse(data);
}

// --- –õ–û–ì–ò–ö–ê –†–£–õ–ï–¢–ö–ò ---
function openChest(price) {
    if(state.points < price) {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤!");
        return;
    }
    state.points -= price;
    save();
    render();

    const modal = document.getElementById('caseModal');
    const track = document.getElementById('rouletteTrack');
    const winDisplay = document.getElementById('winDisplay');
    modal.style.display = 'flex';
    winDisplay.style.display = 'none';
    track.style.transform = 'translateX(0)';
    track.innerHTML = '';

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 50 –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –ª–µ–Ω—Ç—ã
    const items = [];
    for(let i=0; i<50; i++) {
        const item = LOOT_POOL[Math.floor(Math.random() * LOOT_POOL.length)];
        items.push(item);
        const div = document.createElement('div');
        div.className = 'roulette-item';
        div.style.borderColor = RARITY_COLORS[item.rarity];
        div.innerHTML = item.icon;
        track.appendChild(div);
    }

    // –ü–æ–±–µ–¥–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 45-–π –≤ —Å–ø–∏—Å–∫–µ)
    const winIndex = 45;
    const winningItem = items[winIndex];

    setTimeout(() => {
        track.style.transition = 'transform 4s cubic-bezier(0.15, 0, 0.15, 1)';
        const shift = winIndex * 110 - (track.parentElement.offsetWidth / 2 - 55);
        track.style.transform = `translateX(-${shift}px)`;
    }, 100);

    setTimeout(() => {
        winDisplay.style.display = 'block';
        document.getElementById('winIcon').innerHTML = winningItem.icon;
        document.getElementById('winName').innerText = winningItem.name;
        document.getElementById('winName').style.color = RARITY_COLORS[winningItem.rarity];
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
        if(!state.inventory.find(i => i.id === winningItem.id)) {
            state.inventory.push(winningItem);
        }
        save();
    }, 4500);
}

function closeModal() {
    document.getElementById('caseModal').style.display = 'none';
    render();
}

// --- –ö–û–ú–ü–û–ù–ï–ù–¢–´ –†–ï–ù–î–ï–†–ê ---
function drawLivi() {
    const head = state.inventory.find(i => i.id === state.equipped.head);
    const glass = state.inventory.find(i => i.id === state.equipped.glass);
    const body = state.inventory.find(i => i.id === state.equipped.body);

    return `
    <div class="livi-container float">
        ${head ? `<div class="item-cap" style="background:${RARITY_COLORS[head.rarity]}">${head.icon}</div>` : ''}
        <div class="livi-body">
            <div class="livi-eye eye-left"></div>
            <div class="livi-eye eye-right"></div>
            <div class="livi-mouth"></div>
            ${glass ? `<div class="item-glasses"></div>` : ''}
        </div>
        ${body ? `<div class="item-shirt">${body.icon}</div>` : ''}
    </div>`;
}

function renderHome() {
    return `
    <div class="slide-up">
        ${drawLivi()}
        <div class="grid-2">
            <div class="card" style="text-align:center">
                <div style="font-size:12px; color:#888">–≠–Ω–µ—Ä–≥–∏—è</div>
                <div style="font-size:24px; font-weight:bold; color:#4cd137">${state.energy}%</div>
            </div>
            <div class="card" style="text-align:center">
                <div style="font-size:12px; color:#888">–°—Ç–∞—Ç—É—Å</div>
                <div style="font-size:18px; font-weight:bold; color:var(--primary)">–ü—Ä–æ—Ñ–∏</div>
            </div>
        </div>
        <div class="card">
            <h3>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–µ–≥–æ–¥–Ω—è</h3>
            <p style="color:#888; font-size:14px; margin-top:5px">–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞—á: ${state.tasksDone}</p>
            <div style="margin-top:15px; height:8px; background:#222; border-radius:4px">
                <div style="width:40%; height:100%; background:var(--primary); border-radius:4px"></div>
            </div>
        </div>
        <button class="btn btn-stars" onclick="alert('–ï–©–ï –í –†–ê–ó–†–ê–ë–û–¢–ö–ï')">‚≠ê –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
    </div>`;
}

function renderShop() {
    return `
    <div class="slide-up">
        <h2 style="margin-bottom:20px">–ú–∞–≥–∞–∑–∏–Ω —Å—É–Ω–¥—É–∫–æ–≤</h2>
        <div class="card chest-card">
            <div style="font-size:50px">üì¶</div>
            <h3>–û–±—ã—á–Ω—ã–π —Å—É–Ω–¥—É–∫</h3>
            <div class="chest-price">150 pts</div>
            <button class="btn btn-primary" onclick="openChest(150)">–û—Ç–∫—Ä—ã—Ç—å</button>
        </div>
        <div class="card chest-card" style="border-color:var(--rare)">
            <div style="font-size:50px">üíº</div>
            <h3>–†–µ–¥–∫–∏–π —Å—É–Ω–¥—É–∫</h3>
            <div class="chest-price">300 pts</div>
            <button class="btn btn-primary" onclick="openChest(300)">–û—Ç–∫—Ä—ã—Ç—å</button>
        </div>
        <div class="card chest-card" style="border-color:var(--legendary)">
            <div style="font-size:50px">üëë</div>
            <h3>–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∫–µ–π—Å</h3>
            <div class="chest-price">1000 pts</div>
            <button class="btn btn-primary" onclick="openChest(1000)">–û—Ç–∫—Ä—ã—Ç—å</button>
        </div>
    </div>`;
}

function renderAnalysis() {
    const bars = state.stats.map((s, i) => `
        <div class="chart-bar" style="height:${s}%">
            <div class="chart-label">${['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'][i]}</div>
        </div>
    `).join('');

    return `
    <div class="slide-up">
        <div class="card">
            <span class="ai-badge">AI ANALYTICS</span>
            <h3>–ê–Ω–∞–ª–∏–∑ –ø–æ–≤–µ–¥–µ–Ω–∏—è</h3>
            <p class="ai-text" style="margin-top:10px">
                "–ó–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é —Ç–≤–æ—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤—ã—Ä–æ—Å–ª–∞ –Ω–∞ 12%. 
                –¢–≤–æ–π –ø–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ <b>–°—Ä–µ–¥—É</b>. 
                –°–æ–≤–µ—Ç: —Å—Ç–∞—Ä–∞–π—Å—è –∑–∞–∫—Ä—ã–≤–∞—Ç—å –º–µ–ª–∫–∏–µ –∑–∞–¥–∞—á–∏ –¥–æ –æ–±–µ–¥–∞, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é –∫ –≤–µ—á–µ—Ä—É."
            </p>
        </div>

        <div class="card">
            <h3>–¢–µ–Ω–¥–µ–Ω—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h3>
            <div class="chart-container">
                ${bars}
            </div>
        </div>

        <div class="card">
            <h3>–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –∑–∞–≤—Ç—Ä–∞</h3>
            <p style="color:#888">–û–∂–∏–¥–∞–µ–º—ã–π —É—Ä–æ–≤–µ–Ω—å —Ñ–æ–∫—É—Å–∞: <b>–í—ã—Å–æ–∫–∏–π</b></p>
        </div>
    </div>`;
}

function renderInventory() {
    const items = state.inventory.map(item => `
        <div class="card" style="display:flex; align-items:center; gap:15px; border-left:4px solid ${RARITY_COLORS[item.rarity]}">
            <div style="font-size:30px">${item.icon}</div>
            <div style="flex:1">
                <div style="font-weight:bold">${item.name}</div>
                <div style="font-size:12px; color:#666">${item.rarity.toUpperCase()}</div>
            </div>
            <button class="btn" style="width:auto; padding:8px 15px; background:${state.equipped[item.type] === item.id ? '#333' : 'var(--primary)'}" 
                onclick="equipItem('${item.id}', '${item.type}')">
                ${state.equipped[item.type] === item.id ? '–°–Ω—è—Ç—å' : '–ù–∞–¥–µ—Ç—å'}
            </button>
        </div>
    `).join('');

    return `<div class="slide-up"><h2>–ì–∞—Ä–¥–µ—Ä–æ–±</h2><br>${items.length ? items : '–¢—É—Ç –ø–æ–∫–∞ –ø—É—Å—Ç–æ...'}</div>`;
}

function equipItem(id, type) {
    if(state.equipped[type] === id) state.equipped[type] = null;
    else state.equipped[type] = id;
    save();
    render();
}

// --- –ì–õ–ê–í–ù–´–ô –¶–ò–ö–õ ---
function render() {
    const app = document.getElementById('app');
    const header = `
        <div class="header">
            <div class="header-title">livi</div>
            <div class="stats-row">
                <div class="stat-item" style="color:var(--gold)">‚≠ê ${state.points}</div>
                <div class="stat-item">üî• ${state.streak}</div>
            </div>
        </div>
    `;

    const nav = `
        <div class="nav">
            <div class="nav-item ${state.activeTab==='home'?'active':''}" onclick="state.activeTab='home';render()">üè†<br>–ì–ª–∞–≤–Ω–∞—è</div>
            <div class="nav-item ${state.activeTab==='shop'?'active':''}" onclick="state.activeTab='shop';render()">üì¶<br>–ú–∞–≥–∞–∑–∏–Ω</div>
            <div class="nav-item ${state.activeTab==='inventory'?'active':''}" onclick="state.activeTab='inventory';render()">üëï<br>–í–µ—â–∏</div>
            <div class="nav-item ${state.activeTab==='analysis'?'active':''}" onclick="state.activeTab='analysis';render()">üìä<br>–ê–Ω–∞–ª–∏–∑</div>
        </div>
    `;

    let content = '';
    if(state.activeTab === 'home') content = renderHome();
    else if(state.activeTab === 'shop') content = renderShop();
    else if(state.activeTab === 'analysis') content = renderAnalysis();
    else if(state.activeTab === 'inventory') content = renderInventory();

    app.innerHTML = header + `<div class="content">${content}</div>` + nav;
}

window.onload = () => {
    load();
    render();
    setTimeout(() => {
        document.getElementById('loadingScreen').style.opacity = '0';
        setTimeout(() => document.getElementById('loadingScreen').remove(), 500);
    }, 1000);
};

</script>
</body>
</html>
