<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>livi</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.5.0/Recharts.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #1a1a1a;
            color: white;
            max-width: 428px;
            margin: 0 auto;
            overflow-x: hidden;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes gentlePulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.02); opacity: 0.95; }
        }

        .fade-in { animation: fadeIn 0.6s ease-out; }
        .slide-in { animation: slideIn 0.5s ease-out; }
        .gentle-pulse { animation: gentlePulse 3s ease-in-out infinite; }
        .card-hover:active { transform: scale(0.97); }

        .hidden { display: none !important; }

        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }

        .auth-box {
            width: 100%;
            max-width: 400px;
        }

        .logo-section {
            text-align: center;
            margin-bottom: 48px;
        }

        .logo-title {
            font-size: 48px;
            font-weight: bold;
            color: #8B9A9C;
            margin-bottom: 12px;
        }

        .logo-subtitle {
            font-size: 18px;
            color: #999;
        }

        .card {
            background-color: #0f0f0f;
            border: 1px solid #2a2a2a;
            border-radius: 24px;
            padding: 32px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #999;
            margin-bottom: 8px;
        }

        .input-wrapper {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 16px;
            top: 16px;
            width: 20px;
            height: 20px;
            color: #666;
        }

        input, textarea {
            width: 100%;
            padding: 16px 16px 16px 48px;
            background-color: #0a0a0a;
            border: 1px solid #2a2a2a;
            border-radius: 16px;
            color: white;
            font-size: 16px;
            outline: none;
        }

        textarea {
            min-height: 128px;
            resize: vertical;
        }

        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 16px;
            font-weight: bold;
            font-size: 18px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: #8B9A9C;
            color: white;
        }

        .btn-secondary {
            background-color: #0a0a0a;
            color: #8B9A9C;
        }

        .text-link {
            text-align: center;
            margin-top: 24px;
            font-size: 14px;
            color: #8B9A9C;
            cursor: pointer;
        }

        .progress-bar-container {
            display: flex;
            gap: 8px;
            margin-bottom: 32px;
        }

        .progress-bar {
            height: 4px;
            flex: 1;
            border-radius: 2px;
            background-color: #2a2a2a;
        }

        .progress-bar.active {
            background-color: #8B9A9C;
        }

        .goal-button {
            width: 100%;
            padding: 20px;
            border-radius: 16px;
            border: 1px solid #2a2a2a;
            background-color: #0a0a0a;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            margin-bottom: 12px;
        }

        .goal-button.selected {
            background-color: rgba(139, 154, 156, 0.2);
            border-color: rgba(139, 154, 156, 0.4);
        }

        .goal-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background-color: rgba(139, 154, 156, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .goal-content {
            flex: 1;
        }

        .goal-title {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .goal-desc {
            font-size: 14px;
            color: #666;
        }

        .header {
            position: sticky;
            top: 0;
            z-index: 50;
            background-color: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid #2a2a2a;
            padding: 16px 20px;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .header-title {
            font-size: 24px;
            font-weight: 600;
        }

        .header-stats {
            display: flex;
            gap: 12px;
        }

        .stat-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 18px;
        }

        .tabs {
            display: flex;
            gap: 16px;
            overflow-x: auto;
        }

        .tab {
            padding-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
            cursor: pointer;
        }

        .tab.active {
            color: white;
            border-bottom-color: #8B9A9C;
        }

        .content {
            padding: 24px 20px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .stat-card {
            background-color: #0f0f0f;
            border: 1px solid #2a2a2a;
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
        }

        .stat-card svg {
            width: 28px;
            height: 28px;
            margin-bottom: 12px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            font-weight: 500;
            color: #666;
        }

        .section {
            background-color: #0f0f0f;
            border: 1px solid #2a2a2a;
            border-radius: 16px;
            padding: 24px;
            margin-top: 24px;
        }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 16px;
        }

        .habit-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .habit-card {
            padding: 16px;
            border-radius: 12px;
            border: 1px solid #2a2a2a;
            background-color: #0a0a0a;
            text-align: center;
            cursor: pointer;
        }

        .habit-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background-color: #0a0a0a;
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
        }

        .checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid #3a3a3a;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .checkbox.checked {
            background-color: #8B9A9C;
            border-color: #8B9A9C;
        }

        .task-title {
            flex: 1;
            font-size: 14px;
            font-weight: 500;
        }

        .task-points {
            font-size: 12px;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 8px;
            background-color: rgba(139, 154, 156, 0.25);
            color: #8B9A9C;
        }

        .modal {
            position: fixed;
            inset: 0;
            z-index: 100;
            display: flex;
            align-items: flex-end;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .modal-content {
            width: 100%;
            background-color: #0f0f0f;
            border-top: 1px solid #2a2a2a;
            border-radius: 24px 24px 0 0;
            padding: 32px;
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal-handle {
            width: 48px;
            height: 4px;
            background-color: #2a2a2a;
            border-radius: 2px;
            margin: 0 auto 24px;
        }

        .livi-character {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 32px 0;
        }

        .livi-circle {
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .livi-inner {
            border-radius: 50%;
        }

        .livi-label {
            margin-top: 24px;
            font-size: 18px;
            font-weight: bold;
        }

        .livi-desc {
            margin-top: 8px;
            font-size: 14px;
            color: #666;
        }

        input[type="time"] {
            text-align: center;
            font-weight: bold;
            font-size: 18px;
        }

        .delete-btn {
            padding: 8px;
            background-color: rgba(255, 68, 68, 0.2);
            border-radius: 8px;
            cursor: pointer;
        }

        svg {
            fill: currentColor;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const colors = {
            primary: '#8B9A9C',
            secondary: '#B8A8C7',
            accent1: '#9CB3B5',
            accent2: '#A8B5C7',
            accent3: '#A5BDA1',
            warning: '#D4AF7A',
        };

        const state = {
            isAuthenticated: false,
            hasCompletedOnboarding: false,
            showRegister: false,
            onboardingStep: 0,
            showPassword: false,
            activeTab: 'home',
            showRankModal: false,
            selectedHabit: null,
            newTask: '',
            userGoals: {
                health: false,
                learning: false,
                productivity: false,
                mindfulness: false,
                sleep: false,
                social: false
            },
            userInfo: {
                name: '',
                email: '',
                password: '',
                wakeUpTime: '7:00',
                sleepTime: '23:00',
                mainGoal: ''
            },
            tasks: [
                { id: 1, title: '–ü—Ä–æ—á–∏—Ç–∞—Ç—å 30 —Å—Ç—Ä–∞–Ω–∏—Ü', completed: true, category: '–û–±—É—á–µ–Ω–∏–µ', points: 10 },
                { id: 2, title: '–£—Ç—Ä–µ–Ω–Ω—è—è –∑–∞—Ä—è–¥–∫–∞', completed: true, category: '–ó–¥–æ—Ä–æ–≤—å–µ', points: 15 },
                { id: 3, title: '–ú–µ–¥–∏—Ç–∞—Ü–∏—è 15 –º–∏–Ω', completed: false, category: '–ó–¥–æ—Ä–æ–≤—å–µ', points: 10 },
                { id: 4, title: '–í—ã—É—á–∏—Ç—å 20 —Å–ª–æ–≤', completed: false, category: '–û–±—É—á–µ–Ω–∏–µ', points: 20 },
            ],
            habits: [
                { id: 1, name: '–ó–∞—Ä—è–¥–∫–∞', streak: 14, completed: true, color: colors.accent3 },
                { id: 2, name: '–ß—Ç–µ–Ω–∏–µ', streak: 21, completed: true, color: colors.primary },
                { id: 3, name: '–ú–µ–¥–∏—Ç–∞—Ü–∏—è', streak: 7, completed: false, color: colors.secondary },
                { id: 4, name: '–í–æ–¥–∞ 2–ª', streak: 12, completed: true, color: colors.accent1 }
            ],
            streak: 14
        };

        function createSvg(name, color = 'currentColor') {
            const icons = {
                mail: '<path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/>',
                lock: '<rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>',
                user: '<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>',
                eye: '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>',
                eyeOff: '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/>',
                arrowRight: '<line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/>',
                heart: '<path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>',
                book: '<path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>',
                target: '<circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/>',
                brain: '<path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/>',
                moon: '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>',
                coffee: '<path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/>',
                sunrise: '<path d="M17 18a5 5 0 0 0-10 0"/><line x1="12" y1="2" x2="12" y2="9"/><line x1="4.22" y1="10.22" x2="5.64" y2="11.64"/><line x1="1" y1="18" x2="3" y2="18"/><line x1="21" y1="18" x2="23" y2="18"/><line x1="18.36" y1="11.64" x2="19.78" y2="10.22"/><line x1="23" y1="22" x2="1" y2="22"/><polyline points="8 6 12 2 16 6"/>',
                check: '<polyline points="20 6 9 17 4 12"/>',
                sparkles: '<path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/>',
                flame: '<path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/>',
                star: '<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>',
                clock: '<circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>',
                zap: '<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>',
                award: '<circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/>',
                trendingUp: '<polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/>',
                chevronRight: '<polyline points="9 18 15 12 9 6"/>',
                plus: '<line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>',
                trash: '<polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>',
                circle: '<circle cx="12" cy="12" r="10"/>',
                x: '<line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>'
            };
            return `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">${icons[name]}</svg>`;
        }

        function getLiviState(energy, completion, habits, screenTime) {
            const avgScore = (energy + completion + (habits / 4 * 100)) / 3;
            
            if (avgScore >= 85) return {
                size: 140,
                opacity: 1,
                glow: '0 0 40px rgba(139, 154, 156, 0.6)',
                color: '#8B9A9C',
                innerSize: 100,
                label: '–ü—Ä–æ—Ü–≤–µ—Ç–∞—é—â–∏–π'
            };
            if (avgScore >= 70) return {
                size: 120,
                opacity: 0.9,
                glow: '0 0 30px rgba(139, 154, 156, 0.4)',
                color: '#8B9A9C',
                innerSize: 85,
                label: '–°—Ç–∞–±–∏–ª—å–Ω—ã–π'
            };
            if (avgScore >= 50) return {
                size: 100,
                opacity: 0.75,
                glow: '0 0 20px rgba(139, 154, 156, 0.3)',
                color: '#8B9A9C',
                innerSize: 70,
                label: '–§–æ—Ä–º–∏—Ä—É—é—â–∏–π—Å—è'
            };
            return {
                size: 80,
                opacity: 0.6,
                glow: '0 0 10px rgba(139, 154, 156, 0.2)',
                color: '#666',
                innerSize: 55,
                label: '–ó–∞—Ä–æ–∂–¥–∞—é—â–∏–π—Å—è'
            };
        }

        function getRank(streakDays) {
            if (streakDays >= 100) return { title: '–õ–µ–≥–µ–Ω–¥–∞', icon: 'üëë', level: 6, color: '#FFD700', min: 100 };
            if (streakDays >= 50) return { title: '–ú–∞—Å—Ç–µ—Ä', icon: '‚≠ê', level: 5, color: colors.warning, min: 50 };
            if (streakDays >= 30) return { title: '–ü—Ä–æ—Ñ–∏', icon: 'üî•', level: 4, color: colors.accent3, min: 30 };
            if (streakDays >= 14) return { title: '–≠–Ω—Ç—É–∑–∏–∞—Å—Ç', icon: 'üí™', level: 3, color: colors.primary, min: 14 };
            if (streakDays >= 7) return { title: '–°—Ç–∞—Ä—Ç–µ—Ä', icon: 'üå±', level: 2, color: colors.accent2, min: 7 };
            return { title: '–ù–æ–≤–∏—á–æ–∫', icon: 'üåü', level: 1, color: colors.secondary, min: 0 };
        }

        function generateAIAnalysis() {
            const completedTasks = state.tasks.filter(t => t.completed).length;
            const totalTasks = state.tasks.length;
            const completionRate = (completedTasks / totalTasks) * 100;
            const avgEnergy = 88;
            const avgScreenTime = 3.8;
            const activeHabits = state.habits.filter(h => h.completed).length;

            let insights = [];
            let recommendations = [];
            let reflections = [];

            reflections.push(`${Math.round(completionRate)}% –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ`);
            reflections.push(`–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å —ç–Ω–µ—Ä–≥–∏–∏: ${Math.round(avgEnergy)}%`);
            reflections.push(`–≠–∫—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è: ${avgScreenTime.toFixed(1)}—á/–¥–µ–Ω—å`);
            reflections.push(`${activeHabits} –∏–∑ ${state.habits.length} –ø—Ä–∏–≤—ã—á–µ–∫ –∞–∫—Ç–∏–≤–Ω—ã`);
            reflections.push(`–¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è: ${state.streak} –¥–Ω–µ–π`);

            if (completionRate >= 75) {
                insights.push('–û—Ç–ª–∏—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å! –í—ã –≤—ã–ø–æ–ª–Ω—è–µ—Ç–µ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∑–∞–¥–∞—á.');
            } else if (completionRate >= 50) {
                insights.push('–•–æ—Ä–æ—à–∞—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –Ω–æ –µ—Å—Ç—å –∫—É–¥–∞ —Ä–∞—Å—Ç–∏.');
                recommendations.push('–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–±–∏—Ç—å –∫—Ä—É–ø–Ω—ã–µ –∑–∞–¥–∞—á–∏ –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ');
            } else {
                insights.push('–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ. –í–æ–∑–º–æ–∂–Ω–æ, –∑–∞–¥–∞—á–∏ —Å–ª–∏—à–∫–æ–º –∞–º–±–∏—Ü–∏–æ–∑–Ω—ã–µ?');
                recommendations.push('–ù–∞—á–Ω–∏—Ç–µ —Å 3-4 –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á –≤ –¥–µ–Ω—å');
            }

            if (avgEnergy >= 85) {
                insights.push('–í–∞—à —É—Ä–æ–≤–µ–Ω—å —ç–Ω–µ—Ä–≥–∏–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ –≤—ã—Å–æ–∫–∏–π!');
            } else if (avgEnergy >= 70) {
                insights.push('–≠–Ω–µ—Ä–≥–∏—è –≤ –Ω–æ—Ä–º–µ, –Ω–æ –±—ã–≤–∞—é—Ç —Å–ø–∞–¥—ã.');
                recommendations.push('–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞');
            } else {
                insights.push('–ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —ç–Ω–µ—Ä–≥–∏–∏ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è.');
                recommendations.push('–î–æ–±–∞–≤—å—Ç–µ —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∂–∏–º —Å–Ω–∞');
            }

            if (avgScreenTime > 5) {
                insights.push(`–≠–∫—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã—Å–æ–∫–æ–µ: ${avgScreenTime.toFixed(1)}—á –≤ –¥–µ–Ω—å.`);
                recommendations.push('–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ª–∏–º–∏—Ç—ã –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π (–º–∞–∫—Å. 1 —á–∞—Å)');
                recommendations.push('–î–µ–ª–∞–π—Ç–µ –ø–µ—Ä–µ—Ä—ã–≤—ã –∫–∞–∂–¥—ã–µ 45 –º–∏–Ω—É—Ç');
            } else if (avgScreenTime > 4) {
                insights.push('–≠–∫—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã.');
                recommendations.push('–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–ª–µ–¥–∏—Ç—å –∑–∞ –±–∞–ª–∞–Ω—Å–æ–º');
            }

            if (activeHabits >= 3) {
                insights.push('–í—ã –æ—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç–µ—Å—å —Å –ø—Ä–∏–≤—ã—á–∫–∞–º–∏!');
            } else {
                insights.push('–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ —Ç—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è.');
                recommendations.push('–§–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –æ–¥–Ω–æ–π –ø—Ä–∏–≤—ã—á–∫–µ –∑–∞ —Ä–∞–∑');
            }

            if (state.userGoals.sleep && avgScreenTime > 4) {
                recommendations.push('–î–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å–Ω–∞: –ø—Ä–µ–∫—Ä–∞—â–∞–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤ –∑–∞ 1 —á–∞—Å –¥–æ —Å–Ω–∞');
            }

            return {
                insights,
                recommendations,
                reflections,
                completionRate: Math.round(completionRate),
                avgEnergy: Math.round(avgEnergy),
                activeHabits,
                avgScreenTime
            };
        }

        function render() {
            const app = document.getElementById('app');
            
            if (!state.isAuthenticated) {
                app.innerHTML = renderAuth();
                attachAuthListeners();
                return;
            }

            if (!state.hasCompletedOnboarding) {
                app.innerHTML = renderOnboarding();
                attachOnboardingListeners();
                return;
            }

            app.innerHTML = renderMain();
            attachMainListeners();
        }

        function renderAuth() {
            if (!state.showRegister) {
                return `
                    <div class="auth-container fade-in">
                        <div class="auth-box">
                            <div class="logo-section">
                                <h1 class="logo-title">livi</h1>
                                <p class="logo-subtitle">–í–∞—à –ø—É—Ç—å –∫ –ª—É—á—à–µ–π –≤–µ—Ä—Å–∏–∏ —Å–µ–±—è</p>
                            </div>
                            <div class="card">
                                <h2 style="font-size: 24px; font-weight: bold; margin-bottom: 24px; color: white;">–í—Ö–æ–¥</h2>
                                <form id="loginForm">
                                    <div class="form-group">
                                        <label class="form-label">Email</label>
                                        <div class="input-wrapper">
                                            <div class="input-icon">${createSvg('mail', '#666')}</div>
                                            <input type="email" id="email" placeholder="your@email.com" required>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                                        <div class="input-wrapper">
                                            <div class="input-icon">${createSvg('lock', '#666')}</div>
                                            <input type="${state.showPassword ? 'text' : 'password'}" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required style="padding-right: 48px;">
                                            <button type="button" id="togglePassword" style="position: absolute; right: 16px; top: 16px; background: none; border: none; cursor: pointer; padding: 0;">
                                                ${state.showPassword ? createSvg('eyeOff', '#666') : createSvg('eye', '#666')}
                                            </button>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary" style="margin-top: 24px;">–í–æ–π—Ç–∏</button>
                                </form>
                                <div class="text-link" id="showRegister">
                                    –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                return `
                    <div class="auth-container fade-in">
                        <div class="auth-box">
                            <div class="logo-section">
                                <h1 class="logo-title">livi</h1>
                                <p class="logo-subtitle">–í–∞—à –ø—É—Ç—å –∫ –ª—É—á—à–µ–π –≤–µ—Ä—Å–∏–∏ —Å–µ–±—è</p>
                            </div>
                            <div class="card">
                                <h2 style="font-size: 24px; font-weight: bold; margin-bottom: 24px; color: white;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                                <form id="registerForm">
                                    <div class="form-group">
                                        <label class="form-label">–ò–º—è</label>
                                        <div class="input-wrapper">
                                            <div class="input-icon">${createSvg('user', '#666')}</div>
                                            <input type="text" id="name" placeholder="–í–∞—à–µ –∏–º—è" required>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Email</label>
                                        <div class="input-wrapper">
                                            <div class="input-icon">${createSvg('mail', '#666')}</div>
                                            <input type="email" id="email" placeholder="your@email.com" required>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                                        <div class="input-wrapper">
                                            <div class="input-icon">${createSvg('lock', '#666')}</div>
                                            <input type="${state.showPassword ? 'text' : 'password'}" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required style="padding-right: 48px;">
                                            <button type="button" id="togglePassword" style="position: absolute; right: 16px; top: 16px; background: none; border: none; cursor: pointer; padding: 0;">
                                                ${state.showPassword ? createSvg('eyeOff', '#666') : createSvg('eye', '#666')}
                                            </button>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary" style="margin-top: 24px;">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                                </form>
                                <div class="text-link" id="showLogin">
                                    –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function renderOnboarding() {
            const steps = [
                {
                    title: `–ü—Ä–∏–≤–µ—Ç${state.userInfo.name ? ', ' + state.userInfo.name : ''}! üëã`,
                    subtitle: '–î–∞–≤–∞–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏–º livi –ø–æ–¥ –≤–∞—à–∏ —Ü–µ–ª–∏',
                    content: `
                        <div style="text-align: center;">
                            <p style="font-size: 18px; color: #999; margin-bottom: 24px;">
                                –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤, —á—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à –æ–ø—ã—Ç
                            </p>
                            <button class="btn btn-primary" id="startOnboarding">
                                –ù–∞—á–∞—Ç—å ${createSvg('arrowRight', 'white')}
                            </button>
                        </div>
                    `
                },
                {
                    title: '–í–∞—à–∏ —Ü–µ–ª–∏',
                    subtitle: '–í—ã–±–µ—Ä–∏—Ç–µ, –Ω–∞–¥ —á–µ–º —Ö–æ—Ç–∏—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å',
                    content: `
                        <div>
                            ${[
                                { key: 'health', icon: 'heart', label: '–ó–¥–æ—Ä–æ–≤—å–µ', desc: '–°–ø–æ—Ä—Ç, –ø–∏—Ç–∞–Ω–∏–µ, —Å–æ–Ω' },
                                { key: 'learning', icon: 'book', label: '–û–±—É—á–µ–Ω–∏–µ', desc: '–ß—Ç–µ–Ω–∏–µ, –∫—É—Ä—Å—ã, –Ω–∞–≤—ã–∫–∏' },
                                { key: 'productivity', icon: 'target', label: '–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å', desc: '–ó–∞–¥–∞—á–∏, –ø—Ä–æ–µ–∫—Ç—ã, —Ä–∞–±–æ—Ç–∞' },
                                { key: 'mindfulness', icon: 'brain', label: '–û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å', desc: '–ú–µ–¥–∏—Ç–∞—Ü–∏—è, –¥—ã—Ö–∞–Ω–∏–µ' },
                                { key: 'sleep', icon: 'moon', label: '–°–æ–Ω', desc: '–†–µ–∂–∏–º, –∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞' },
                                { key: 'social', icon: 'coffee', label: '–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∂–∏–∑–Ω—å', desc: '–î—Ä—É–∑—å—è, —Ö–æ–±–±–∏' }
                            ].map(goal => `
                                <button class="goal-button ${state.userGoals[goal.key] ? 'selected' : ''}" data-goal="${goal.key}">
                                    <div class="goal-icon">${createSvg(goal.icon, colors.primary)}</div>
                                    <div class="goal-content">
                                        <div class="goal-title">${goal.label}</div>
                                        <div class="goal-desc">${goal.desc}</div>
                                    </div>
                                    ${state.userGoals[goal.key] ? createSvg('check', colors.primary) : ''}
                                </button>
                            `).join('')}
                            <button class="btn btn-primary" id="nextStep" style="margin-top: 24px;" ${!Object.values(state.userGoals).some(v => v) ? 'disabled' : ''}>
                                –î–∞–ª–µ–µ
                            </button>
                        </div>
                    `
                },
                {
                    title: '–í–∞—à —Ä–µ–∂–∏–º',
                    subtitle: '–ö–æ–≥–¥–∞ –≤—ã –æ–±—ã—á–Ω–æ –ø—Ä–æ—Å—ã–ø–∞–µ—Ç–µ—Å—å –∏ –ª–æ–∂–∏—Ç–µ—Å—å —Å–ø–∞—Ç—å?',
                    content: `
                        <div>
                            <div style="margin-bottom: 24px;">
                                <label class="form-label">
                                    ${createSvg('sunrise', colors.warning)} –í—Ä–µ–º—è –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è
                                </label>
                                <input type="time" id="wakeUpTime" value="${state.userInfo.wakeUpTime}" style="padding: 16px; width: 100%;">
                            </div>
                            <div style="margin-bottom: 24px;">
                                <label class="form-label">
                                    ${createSvg('moon', colors.secondary)} –í—Ä–µ–º—è —Å–Ω–∞
                                </label>
                                <input type="time" id="sleepTime" value="${state.userInfo.sleepTime}" style="padding: 16px; width: 100%;">
                            </div>
                            <button class="btn btn-primary" id="nextStep">–î–∞–ª–µ–µ</button>
                        </div>
                    `
                },
                {
                    title: '–ü–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–≥!',
                    subtitle: '–ö–∞–∫–∞—è –≤–∞—à–∞ –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–π –º–µ—Å—è—Ü?',
                    content: `
                        <div>
                            <textarea id="mainGoal" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ß–∏—Ç–∞—Ç—å 30 –º–∏–Ω—É—Ç –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, –ø—Ä–æ–±–µ–∂–∞—Ç—å 5–∫–º, –≤—ã—É—á–∏—Ç—å 500 –Ω–æ–≤—ã—Ö —Å–ª–æ–≤...">${state.userInfo.mainGoal}</textarea>
                            <button class="btn btn-primary" id="completeOnboarding" style="margin-top: 24px;">
                                –ù–∞—á–∞—Ç—å –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ ${createSvg('sparkles', 'white')}
                            </button>
                        </div>
                    `
                }
            ];

            const currentStep = steps[state.onboardingStep];

            return `
                <div class="auth-container slide-in">
                    <div class="auth-box">
                        <div class="progress-bar-container">
                            ${steps.map((_, i) => `
                                <div class="progress-bar ${i <= state.onboardingStep ? 'active' : ''}"></div>
                            `).join('')}
                        </div>
                        <div class="card">
                            <h2 style="font-size: 28px; font-weight: bold; margin-bottom: 8px; color: white;">${currentStep.title}</h2>
                            <p style="font-size: 16px; color: #999; margin-bottom: 32px;">${currentStep.subtitle}</p>
                            ${currentStep.content}
                        </div>
                        ${state.onboardingStep > 0 ? `
                            <button id="prevStep" style="margin-top: 16px; width: 100%; padding: 12px; background: none; border: none; color: #666; cursor: pointer; font-weight: 500;">
                                –ù–∞–∑–∞–¥
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderMain() {
            const completedTasks = state.tasks.filter(t => t.completed).length;
            const totalPoints = state.tasks.filter(t => t.completed).reduce((sum, t) => sum + t.points, 0);
            const currentRank = getRank(state.streak);
            const aiAnalysis = generateAIAnalysis();

            return `
                <div class="header">
                    <div class="header-top">
                        <div class="header-title">livi</div>
                        <div class="header-stats">
                            <button class="stat-badge gentle-pulse" style="background-color: ${colors.warning}20;" id="showRank">
                                ${createSvg('flame', colors.warning)}
                                <span>${state.streak}</span>
                            </button>
                            <button class="stat-badge" style="background-color: ${colors.primary}20;">
                                ${createSvg('star', colors.primary)}
                                <span>${totalPoints}</span>
                            </button>
                        </div>
                    </div>
                    <div class="tabs">
                        ${['home', 'tasks', 'analysis', 'livi'].map(tab => `
                            <div class="tab ${state.activeTab === tab ? 'active' : ''}" data-tab="${tab}">
                                ${tab === 'home' ? '–ì–ª–∞–≤–Ω–∞—è' : tab === 'tasks' ? '–ó–∞–¥–∞—á–∏' : tab === 'analysis' ? '–ê–Ω–∞–ª–∏–∑' : 'Livi'}
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="content">
                    <div id="tabContent">${renderTabContent(completedTasks, currentRank, aiAnalysis)}</div>
                </div>
                ${state.showRankModal ? renderRankModal(currentRank) : ''}
                ${state.selectedHabit ? renderHabitModal() : ''}
            `;
        }

        function renderTabContent(completedTasks, currentRank, aiAnalysis) {
            if (state.activeTab === 'home') {
                return `
                    <div class="grid-2">
                        ${[
                            { icon: 'target', value: `${completedTasks}/${state.tasks.length}`, label: '–ó–∞–¥–∞—á–∏', color: colors.primary },
                            { icon: 'clock', value: '3.8—á', label: '–≠–∫—Ä–∞–Ω', color: colors.accent3 },
                            { icon: 'zap', value: '88%', label: '–≠–Ω–µ—Ä–≥–∏—è', color: colors.warning },
                            { icon: 'award', value: currentRank.icon, label: currentRank.title, color: currentRank.color }
                        ].map(stat => `
                            <div class="stat-card card-hover">
                                ${createSvg(stat.icon, stat.color)}
                                <div class="stat-value">${stat.value}</div>
                                <div class="stat-label">${stat.label}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="section">
                        <h2 class="section-title">–ü—Ä–∏–≤—ã—á–∫–∏</h2>
                        <div class="habit-grid">
                            ${state.habits.map(habit => `
                                <div class="habit-card card-hover" data-habit="${habit.id}" style="background-color: ${habit.completed ? habit.color + '15' : '#0a0a0a'}; border-color: ${habit.completed ? habit.color + '40' : '#2a2a2a'};">
                                    <div class="habit-icon" style="background-color: ${habit.color}30;">
                                        <div style="font-size: 24px;">${habit.completed ? '‚úì' : '‚óã'}</div>
                                    </div>
                                    <div style="font-size: 14px; font-weight: bold; margin-bottom: 8px;">${habit.name}</div>
                                    <div style="display: flex; align-items: center; justify-content: center; gap: 4px;">
                                        ${createSvg('flame', colors.warning)}
                                        <span style="font-size: 16px; font-weight: bold;">${habit.streak}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="section">
                        <h2 class="section-title">–°–µ–≥–æ–¥–Ω—è</h2>
                        ${state.tasks.slice(0, 4).map(task => `
                            <div class="task-item card-hover" data-task="${task.id}">
                                <div class="checkbox ${task.completed ? 'checked' : ''}">
                                    ${task.completed ? createSvg('check', 'white') : ''}
                                </div>
                                <div class="task-title ${task.completed ? 'line-through' : ''}" style="color: ${task.completed ? '#666' : 'white'};">
                                    ${task.title}
                                </div>
                                <div class="task-points">+${task.points}</div>
                            </div>
                        `).join('')}
                        <button class="btn btn-secondary" id="goToTasks" style="margin-top: 16px;">–í—Å–µ –∑–∞–¥–∞—á–∏ ‚Üí</button>
                    </div>
                `;
            } else if (state.activeTab === 'tasks') {
                return `
                    <div class="section">
                        <h2 class="section-title">–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</h2>
                        <div style="display: flex; gap: 12px;">
                            <input type="text" id="newTaskInput" placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?" value="${state.newTask}" style="flex: 1; padding: 12px 16px;">
                            <button class="btn btn-primary" id="addTask" style="width: auto; padding: 12px 16px;">
                                ${createSvg('plus', 'white')}
                            </button>
                        </div>
                    </div>

                    <div class="section">
                        <h2 class="section-title">–í—Å–µ –∑–∞–¥–∞—á–∏</h2>
                        ${state.tasks.map(task => `
                            <div class="task-item" style="margin-bottom: 12px;">
                                <div class="checkbox ${task.completed ? 'checked' : ''}" data-task="${task.id}">
                                    ${task.completed ? createSvg('check', 'white') : ''}
                                </div>
                                <div class="task-title ${task.completed ? 'line-through' : ''}" style="color: ${task.completed ? '#666' : 'white'}; cursor: pointer;" data-task="${task.id}">
                                    ${task.title}
                                </div>
                                <div class="task-points">${task.category}</div>
                                <button class="delete-btn" data-delete="${task.id}">
                                    ${createSvg('trash', '#ff4444')}
                                </button>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (state.activeTab === 'analysis') {
                return `
                    <div class="section">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 24px;">
                            ${createSvg('brain', colors.primary)}
                            <div>
                                <h2 style="font-size: 24px; font-weight: bold; margin-bottom: 4px;">–ò–ò –ê–Ω–∞–ª–∏–∑</h2>
                                <p style="font-size: 14px; color: #999;">–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</p>
                            </div>
                        </div>

                        <div class="grid-2" style="margin-bottom: 24px;">
                            <div style="padding: 16px; border-radius: 12px; background-color: ${colors.primary}15; text-align: center;">
                                <div style="font-size: 32px; font-weight: bold; margin-bottom: 4px;">${aiAnalysis.completionRate}%</div>
                                <div style="font-size: 12px; font-weight: 500; color: #999;">–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
                            </div>
                            <div style="padding: 16px; border-radius: 12px; background-color: ${colors.accent3}15; text-align: center;">
                                <div style="font-size: 32px; font-weight: bold; margin-bottom: 4px;">${aiAnalysis.avgEnergy}%</div>
                                <div style="font-size: 12px; font-weight: 500; color: #999;">–≠–Ω–µ—Ä–≥–∏—è</div>
                            </div>
                        </div>

                        <div style="margin-bottom: 24px;">
                            <h3 style="font-size: 16px; font-weight: bold; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                                ${createSvg('sparkles', colors.primary)}
                                –ò–Ω—Å–∞–π—Ç—ã
                            </h3>
                            ${aiAnalysis.insights.map(insight => `
                                <div style="padding: 12px; border-radius: 12px; background-color: #0a0a0a; margin-bottom: 8px;">
                                    <p style="font-size: 14px;">${insight}</p>
                                </div>
                            `).join('')}
                        </div>

                        <div style="margin-bottom: 24px;">
                            <h3 style="font-size: 16px; font-weight: bold; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                                ${createSvg('trendingUp', colors.accent3)}
                                –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
                            </h3>
                            ${aiAnalysis.recommendations.map(rec => `
                                <div style="padding: 12px; border-radius: 12px; background-color: ${colors.accent3}15; margin-bottom: 8px; display: flex; align-items: start; gap: 12px;">
                                    ${createSvg('chevronRight', colors.accent3)}
                                    <p style="font-size: 14px;">${rec}</p>
                                </div>
                            `).join('')}
                        </div>

                        ${state.userInfo.mainGoal ? `
                            <div style="padding: 16px; border-radius: 12px; background-color: ${colors.warning}15;">
                                <p style="font-size: 12px; font-weight: bold; color: ${colors.warning}; margin-bottom: 8px;">–í–ê–®–ê –¶–ï–õ–¨</p>
                                <p style="font-size: 14px;">${state.userInfo.mainGoal}</p>
                            </div>
                        ` : ''}
                    </div>

                    <div class="section">
                        <h3 style="font-size: 18px; font-weight: bold; margin-bottom: 16px;">–í—ã–±—Ä–∞–Ω–Ω—ã–µ —Ü–µ–ª–∏</h3>
                        ${Object.entries(state.userGoals).filter(([_, v]) => v).map(([key]) => {
                            const goalLabels = {
                                health: '–ó–¥–æ—Ä–æ–≤—å–µ',
                                learning: '–û–±—É—á–µ–Ω–∏–µ',
                                productivity: '–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å',
                                mindfulness: '–û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å',
                                sleep: '–°–æ–Ω',
                                social: '–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∂–∏–∑–Ω—å'
                            };
                            return `
                                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 12px; background-color: #0a0a0a; margin-bottom: 8px;">
                                    ${createSvg('check', colors.primary)}
                                    <span style="font-size: 14px; font-weight: 500;">${goalLabels[key]}</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            } else if (state.activeTab === 'livi') {
                const liviState = getLiviState(aiAnalysis.avgEnergy, aiAnalysis.completionRate, aiAnalysis.activeHabits, aiAnalysis.avgScreenTime);
                
                return `
                    <div class="section">
                        <div class="livi-character">
                            <div class="livi-circle" style="width: ${liviState.size}px; height: ${liviState.size}px; background-color: ${liviState.color}20; border: 2px solid ${liviState.color}; opacity: ${liviState.opacity}; box-shadow: ${liviState.glow};">
                                <div class="livi-inner" style="width: ${liviState.innerSize}px; height: ${liviState.innerSize}px; background-color: ${liviState.color}40; border: 1px solid ${liviState.color};"></div>
                            </div>
                            <div class="livi-label" style="color: ${liviState.color};">${liviState.label}</div>
                            <div class="livi-desc">–û—Ç—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è</div>
                        </div>
                    </div>

                    <div class="section">
                        <h2 class="section-title">–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</h2>
                        ${aiAnalysis.reflections.map(reflection => `
                            <div style="padding: 16px; border-radius: 12px; background-color: #0a0a0a; margin-bottom: 12px; display: flex; align-items: center; gap: 12px;">
                                ${createSvg('circle', colors.primary)}
                                <p style="font-size: 14px;">${reflection}</p>
                            </div>
                        `).join('')}
                    </div>

                    ${state.userInfo.mainGoal ? `
                        <div class="section">
                            <p style="font-size: 12px; font-weight: bold; color: #666; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px;">–ó–∞—è–≤–ª–µ–Ω–Ω–∞—è —Ü–µ–ª—å</p>
                            <p style="font-size: 16px;">${state.userInfo.mainGoal}</p>
                        </div>
                    ` : ''}

                    <div class="section">
                        <h3 style="font-size: 18px; font-weight: bold; margin-bottom: 16px;">–í—ã–±—Ä–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h3>
                        ${Object.entries(state.userGoals).filter(([_, v]) => v).map(([key]) => {
                            const goalLabels = {
                                health: '–ó–¥–æ—Ä–æ–≤—å–µ',
                                learning: '–û–±—É—á–µ–Ω–∏–µ',
                                productivity: '–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å',
                                mindfulness: '–û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å',
                                sleep: '–°–æ–Ω',
                                social: '–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∂–∏–∑–Ω—å'
                            };
                            return `
                                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 12px; background-color: #0a0a0a; margin-bottom: 8px;">
                                    ${createSvg('circle', colors.primary)}
                                    <span style="font-size: 14px; font-weight: 500;">${goalLabels[key]}</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }
        }

        function renderRankModal(currentRank) {
            const nextRank = getRank(currentRank.min + 1);
            const progressToNext = currentRank.min === 100 ? 100 : ((state.streak - currentRank.min) / (nextRank.min - currentRank.min)) * 100;

            return `
                <div class="modal" id="rankModal">
                    <div class="modal-content" onclick="event.stopPropagation();">
                        <div class="modal-handle"></div>
                        <div style="text-align: center; margin-bottom: 24px;">
                            <div style="font-size: 48px; margin-bottom: 16px;">${currentRank.icon}</div>
                            <h2 style="font-size: 32px; font-weight: bold; margin-bottom: 8px;">${currentRank.title}</h2>
                            <p style="font-size: 16px; color: #999; margin-bottom: 4px;">–£—Ä–æ–≤–µ–Ω—å ${currentRank.level}</p>
                            <p style="font-size: 14px; color: #666;">–¢–µ–∫—É—â–∏–π —Ä–∞–Ω–≥</p>
                        </div>

                        <div style="margin-bottom: 24px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="font-size: 14px; font-weight: 500;">–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
                                <span style="font-size: 14px; font-weight: bold; color: ${colors.primary};">
                                    ${currentRank.min === 100 ? '–ú–∞–∫—Å–∏–º—É–º' : Math.round(progressToNext) + '%'}
                                </span>
                            </div>
                            <div style="height: 12px; border-radius: 6px; background-color: #2a2a2a;">
                                <div style="height: 100%; border-radius: 6px; background-color: ${colors.primary}; width: ${progressToNext}%;"></div>
                            </div>
                            ${currentRank.min !== 100 ? `
                                <p style="font-size: 12px; color: #666; text-align: center; margin-top: 8px;">
                                    –ï—â—ë ${nextRank.min - state.streak} –¥–Ω–µ–π –¥–æ "${nextRank.title}"
                                </p>
                            ` : ''}
                        </div>

                        ${[
                            { title: '–ù–æ–≤–∏—á–æ–∫', icon: 'üåü', level: 1, days: '0-6' },
                            { title: '–°—Ç–∞—Ä—Ç–µ—Ä', icon: 'üå±', level: 2, days: '7-13' },
                            { title: '–≠–Ω—Ç—É–∑–∏–∞—Å—Ç', icon: 'üí™', level: 3, days: '14-29' },
                            { title: '–ü—Ä–æ—Ñ–∏', icon: 'üî•', level: 4, days: '30-49' },
                            { title: '–ú–∞—Å—Ç–µ—Ä', icon: '‚≠ê', level: 5, days: '50-99' },
                            { title: '–õ–µ–≥–µ–Ω–¥–∞', icon: 'üëë', level: 6, days: '100+' }
                        ].map(rank => `
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; border-radius: 12px; background-color: ${rank.title === currentRank.title ? colors.primary + '20' : '#0a0a0a'}; border: 1px solid ${rank.title === currentRank.title ? colors.primary : 'transparent'}; margin-bottom: 8px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background-color: ${colors.primary + (rank.title === currentRank.title ? '40' : '20')}; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                                        ${rank.icon}
                                    </div>
                                    <div>
                                        <div style="font-size: 14px; font-weight: bold;">${rank.title}</div>
                                        <div style="font-size: 12px; color: #666;">–£—Ä–æ–≤–µ–Ω—å ${rank.level} ‚Ä¢ ${rank.days} –¥–Ω–µ–π</div>
                                    </div>
                                </div>
                                ${rank.title === currentRank.title ? createSvg('check', colors.primary) : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderHabitModal() {
            const habit = state.selectedHabit;
            return `
                <div class="modal" id="habitModal">
                    <div class="modal-content" onclick="event.stopPropagation();">
                        <div class="modal-handle"></div>
                        <div style="text-align: center;">
                            <div style="width: 80px; height: 80px; border-radius: 16px; background-color: ${habit.color}30; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 36px;">
                                ${habit.completed ? '‚úì' : '‚óã'}
                            </div>
                            <h2 style="font-size: 24px; font-weight: bold; margin-bottom: 16px;">${habit.name}</h2>
                            <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 24px;">
                                ${createSvg('flame', colors.warning)}
                                <span style="font-size: 32px; font-weight: bold;">${habit.streak}</span>
                                <span style="font-size: 18px; color: #999;">–¥–Ω–µ–π</span>
                            </div>
                            <p style="font-size: 16px; color: #999; margin-bottom: 24px;">
                                ${habit.completed ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è! üéâ' : '–ù–µ –∑–∞–±—É–¥—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å'}
                            </p>
                            <button class="btn" style="background-color: ${habit.color}; color: white;" id="closeHabitModal">
                                –ó–∞–∫—Ä—ã—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function attachAuthListeners() {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const showRegisterBtn = document.getElementById('showRegister');
            const showLoginBtn = document.getElementById('showLogin');
            const togglePasswordBtn = document.getElementById('togglePassword');

            if (loginForm) {
                loginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    state.userInfo.email = document.getElementById('email').value;
                    state.userInfo.password = document.getElementById('password').value;
                    if (state.userInfo.email && state.userInfo.password) {
                        state.isAuthenticated = true;
                        render();
                    }
                });
            }

            if (registerForm) {
                registerForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    state.userInfo.name = document.getElementById('name').value;
                    state.userInfo.email = document.getElementById('email').value;
                    state.userInfo.password = document.getElementById('password').value;
                    if (state.userInfo.name && state.userInfo.email && state.userInfo.password) {
                        state.showRegister = false;
                        state.isAuthenticated = true;
                        render();
                    }
                });
            }

            if (showRegisterBtn) {
                showRegisterBtn.addEventListener('click', () => {
                    state.showRegister = true;
                    render();
                });
            }

            if (showLoginBtn) {
                showLoginBtn.addEventListener('click', () => {
                    state.showRegister = false;
                    render();
                });
            }

            if (togglePasswordBtn) {
                togglePasswordBtn.addEventListener('click', () => {
                    state.showPassword = !state.showPassword;
                    render();
                });
            }
        }

        function attachOnboardingListeners() {
            const startBtn = document.getElementById('startOnboarding');
            const nextBtn = document.getElementById('nextStep');
            const prevBtn = document.getElementById('prevStep');
            const completeBtn = document.getElementById('completeOnboarding');
            const goalButtons = document.querySelectorAll('[data-goal]');

            if (startBtn) {
                startBtn.addEventListener('click', () => {
                    state.onboardingStep = 1;
                    render();
                });
            }

            if (nextBtn) {
                nextBtn.addEventListener('click', () => {
                    if (state.onboardingStep === 2) {
                        state.userInfo.wakeUpTime = document.getElementById('wakeUpTime').value;
                        state.userInfo.sleepTime = document.getElementById('sleepTime').value;
                    }
                    state.onboardingStep++;
                    render();
                });
            }

            if (prevBtn) {
                prevBtn.addEventListener('click', () => {
                    state.onboardingStep--;
                    render();
                });
            }

            if (completeBtn) {
                completeBtn.addEventListener('click', () => {
                    state.userInfo.mainGoal = document.getElementById('mainGoal').value;
                    state.hasCompletedOnboarding = true;
                    render();
                });
            }

            goalButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const goal = btn.dataset.goal;
                    state.userGoals[goal] = !state.userGoals[goal];
                    render();
                });
            });
        }

        function attachMainListeners() {
            const tabs = document.querySelectorAll('[data-tab]');
            const showRankBtn = document.getElementById('showRank');
            const rankModal = document.getElementById('rankModal');
            const habitCards = document.querySelectorAll('[data-habit]');
            const habitModal = document.getElementById('habitModal');
            const closeHabitBtn = document.getElementById('closeHabitModal');
            const taskCheckboxes = document.querySelectorAll('[data-task]');
            const deleteBtns = document.querySelectorAll('[data-delete]');
            const addTaskBtn = document.getElementById('addTask');
            const newTaskInput = document.getElementById('newTaskInput');
            const goToTasksBtn = document.getElementById('goToTasks');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    state.activeTab = tab.dataset.tab;
                    render();
                });
            });

            if (showRankBtn) {
                showRankBtn.addEventListener('click', () => {
                    state.showRankModal = true;
                    render();
                });
            }

            if (rankModal) {
                rankModal.addEventListener('click', () => {
                    state.showRankModal = false;
                    render();
                });
            }

            habitCards.forEach(card => {
                card.addEventListener('click', () => {
                    const habitId = parseInt(card.dataset.habit);
                    state.selectedHabit = state.habits.find(h => h.id === habitId);
                    render();
                });
            });

            if (habitModal) {
                habitModal.addEventListener('click', () => {
                    state.selectedHabit = null;
                    render();
                });
            }

            if (closeHabitBtn) {
                closeHabitBtn.addEventListener('click', () => {
                    state.selectedHabit = null;
                    render();
                });
            }

            taskCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('click', () => {
                    const taskId = parseInt(checkbox.dataset.task);
                    const task = state.tasks.find(t => t.id === taskId);
                    if (task) {
                        task.completed = !task.completed;
                        render();
                    }
                });
            });

            deleteBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const taskId = parseInt(btn.dataset.delete);
                    state.tasks = state.tasks.filter(t => t.id !== taskId);
                    render();
                });
            });

            if (addTaskBtn) {
                addTaskBtn.addEventListener('click', () => {
                    if (newTaskInput && newTaskInput.value.trim()) {
                        state.tasks.push({
                            id: Date.now(),
                            title: newTaskInput.value.trim(),
                            completed: false,
                            category: '–û–±—â–µ–µ',
                            points: 10
                        });
                        state.newTask = '';
                        render();
                    }
                });
            }

            if (newTaskInput) {
                newTaskInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && newTaskInput.value.trim()) {
                        state.tasks.push({
                            id: Date.now(),
                            title: newTaskInput.value.trim(),
                            completed: false,
                            category: '–û–±—â–µ–µ',
                            points: 10
                        });
                        state.newTask = '';
                        render();
                    }
                });
            }

            if (goToTasksBtn) {
                goToTasksBtn.addEventListener('click', () => {
                    state.activeTab = 'tasks';
                    render();
                });
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        render();
    </script>
</body>
</html>
